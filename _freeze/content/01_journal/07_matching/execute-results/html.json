{
  "hash": "872af5e9603774469420307783c3e678",
  "result": {
    "markdown": "---\ntitle: \"Matching and Subclassification\"\n---\n\n\n::: callout-note\n:::\n\n1.)\n\n::: {.cell hash='07_matching_cache/html/unnamed-chunk-1_1a9d4ed8271e3fb640e8253bf78f7997'}\n\n```{.r .cell-code}\nmem_data<-readRDS(\"C:/Users/mouni/Downloads/Causal_Data_Science_Data/Causal_Data_Science_Data/membership.rds\")\nlibrary(\"dagitty\")\ndag <- dagitty('dag {\n  age -> pre_avg_purch\n  sex -> pre_avg_purch\n  card -> avg_purch\n}')\n\n# Plot the DAG\nplot(dag)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Plot coordinates for graph not supplied! Generating coordinates, see ?coordinates for how to set your own.\n```\n:::\n\n::: {.cell-output-display}\n![](07_matching_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n2.)\n\n::: {.cell hash='07_matching_cache/html/unnamed-chunk-2_671758233a8ad26365d0041bddcd8d0f'}\n\n```{.r .cell-code}\nnaive_model <- lm(avg_purch ~ card, data = mem_data)\nsummary(naive_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = avg_purch ~ card, data = mem_data)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -101.515  -20.684   -0.199   20.424  120.166 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  65.9397     0.3965  166.29   <2e-16 ***\n#> card         25.2195     0.6095   41.38   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 30.11 on 9998 degrees of freedom\n#> Multiple R-squared:  0.1462,\tAdjusted R-squared:  0.1461 \n#> F-statistic:  1712 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n3.)\n\n1.\n\n::: {.cell hash='07_matching_cache/html/unnamed-chunk-3_364e43231d9914cd82b8eec6782f072a'}\n\n```{.r .cell-code}\nlibrary(\"MatchIt\")\ncem <- matchit(card ~ age + sex + pre_avg_purch,\n               data = mem_data, \n               method = 'cem', \n               estimand = 'ATE')\nsummary(cem)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> matchit(formula = card ~ age + sex + pre_avg_purch, data = mem_data, \n#>     method = \"cem\", estimand = \"ATE\")\n#> \n#> Summary of Balance for All Data:\n#>               Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean\n#> age                 42.0331       39.1574          0.2136     1.1524    0.0438\n#> sex                  0.5087        0.5002          0.0171          .    0.0086\n#> pre_avg_purch       76.3938       66.0438          0.3962     1.0276    0.1092\n#>               eCDF Max\n#> age             0.0864\n#> sex             0.0086\n#> pre_avg_purch   0.1545\n#> \n#> Summary of Balance for Matched Data:\n#>               Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean\n#> age                 40.1743       40.1557          0.0014     0.9993    0.0016\n#> sex                  0.5040        0.5040          0.0000          .    0.0000\n#> pre_avg_purch       70.4611       70.0938          0.0141     0.9929    0.0044\n#>               eCDF Max Std. Pair Dist.\n#> age             0.0064          0.1222\n#> sex             0.0000          0.0000\n#> pre_avg_purch   0.0130          0.1558\n#> \n#> Sample Sizes:\n#>               Control Treated\n#> All           5768.      4232\n#> Matched (ESS) 5429.65    3844\n#> Matched       5716.      4164\n#> Unmatched       52.        68\n#> Discarded        0.         0\n```\n:::\n:::\n\n\n2.\n\n::: {.cell hash='07_matching_cache/html/unnamed-chunk-4_b319cffec5109ba1d01a6d084c14a4a0'}\n\n```{.r .cell-code}\nnn <- matchit(card ~ age + sex + pre_avg_purch,\n              data = mem_data,\n              method = \"nearest\", # changed\n              distance = \"mahalanobis\", # changed\n              replace = T)\n\n# Covariate Balance\nsummary(nn)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> matchit(formula = card ~ age + sex + pre_avg_purch, data = mem_data, \n#>     method = \"nearest\", distance = \"mahalanobis\", replace = T)\n#> \n#> Summary of Balance for All Data:\n#>               Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean\n#> age                 42.0331       39.1574          0.2064     1.1524    0.0438\n#> sex                  0.5087        0.5002          0.0171          .    0.0086\n#> pre_avg_purch       76.3938       66.0438          0.3936     1.0276    0.1092\n#>               eCDF Max\n#> age             0.0864\n#> sex             0.0086\n#> pre_avg_purch   0.1545\n#> \n#> Summary of Balance for Matched Data:\n#>               Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean\n#> age                 42.0331       41.9964          0.0026     1.0171    0.0014\n#> sex                  0.5087        0.5087          0.0000          .    0.0000\n#> pre_avg_purch       76.3938       76.2937          0.0038     1.0178    0.0012\n#>               eCDF Max Std. Pair Dist.\n#> age             0.0061          0.0281\n#> sex             0.0000          0.0000\n#> pre_avg_purch   0.0076          0.0301\n#> \n#> Sample Sizes:\n#>               Control Treated\n#> All           5768.      4232\n#> Matched (ESS) 1992.19    4232\n#> Matched       2677.      4232\n#> Unmatched     3091.         0\n#> Discarded        0.         0\n```\n:::\n:::\n\n3.\n\n::: {.cell hash='07_matching_cache/html/unnamed-chunk-5_ead9b9953e43c0ef44569a4220a7117d'}\n\n```{.r .cell-code}\ndf_nn <- match.data(nn)\n\n# (2) Estimation\nmodel_nn <- lm(avg_purch ~ card, data = df_nn, weights = weights)\nsummary(model_nn)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = avg_purch ~ card, data = df_nn, weights = weights)\n#> \n#> Weighted Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -132.730  -21.288   -1.675   18.318  146.631 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  76.5634     0.5881  130.19   <2e-16 ***\n#> card         14.5957     0.7514   19.42   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 30.43 on 6907 degrees of freedom\n#> Multiple R-squared:  0.05179,\tAdjusted R-squared:  0.05166 \n#> F-statistic: 377.3 on 1 and 6907 DF,  p-value: < 2.2e-16\n```\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}