{
  "hash": "305d10f31d16da61fcbd15059824acc1",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\n---\n\n\n::: callout-note\n:::\n1.)\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_c50d893f7d016740f3ce7b99f34124bc'}\n\n```{.r .cell-code}\nrand_enc_data<-readRDS(\"C:/Users/mouni/Downloads/Causal_Data_Science_Data/Causal_Data_Science_Data/rand_enc.rds\")\nlibrary(dagitty)\ndag <- dagitty('dag {\n  rand_enc->used_ftr\n  used_ftr->time_spent\n}')\ncoords = list(x = c(Y = 3, Z = 2, X = 1),\n                y = c(Y = 0, Z = 0, X = 0))\nplot(dag)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Plot coordinates for graph not supplied! Generating coordinates, see ?coordinates for how to set your own.\n```\n:::\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n2.)\nThe naive  estimate would be the simple comparison between average time spent by users who were encouraged (rand_enc=1) and those who were not (rand_enc=0).This would be biased due to potential unobserved confounders.\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_73f2209c9aa35c474fa3be42c2070813'}\n\n```{.r .cell-code}\nlibrary(\"dplyr\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following objects are masked from 'package:stats':\n#> \n#>     filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following objects are masked from 'package:base':\n#> \n#>     intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\ndf <- rand_enc_data %>%  group_by (rand_enc) %>% \nsummarize(avg_time_spent=mean(time_spent))\nprint(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 2 Ã— 2\n#>   rand_enc avg_time_spent\n#>      <int>          <dbl>\n#> 1        0           22.3\n#> 2        1           24.3\n```\n:::\n\n```{.r .cell-code}\nlm_naive<-lm(time_spent~used_ftr,data=rand_enc_data)\nsummary(lm_naive)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = time_spent ~ used_ftr, data = rand_enc_data)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -20.4950  -3.5393   0.0158   3.5961  20.5051 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 18.86993    0.06955   271.3   <2e-16 ***\n#> used_ftr    10.82269    0.10888    99.4   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.351 on 9998 degrees of freedom\n#> Multiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \n#> F-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n3.)\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_3474f47c04e36e5ecbad8df9553b46f5'}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ncom_ins<-ggplot(rand_enc_data, aes(x = rand_enc,y=used_ftr)) +\n  geom_point(alpha=0.8) +\n  stat_smooth(method=\"lm\",se=F)\n  labs(title = \"Distribution of Encouragement Variable\",\n       x = \"Encouragement\",\n       y = \"Treat\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> $x\n#> [1] \"Encouragement\"\n#> \n#> $y\n#> [1] \"Treat\"\n#> \n#> $title\n#> [1] \"Distribution of Encouragement Variable\"\n#> \n#> attr(,\"class\")\n#> [1] \"labels\"\n```\n:::\n\n```{.r .cell-code}\ncom_outcome<-ggplot(rand_enc_data, aes(x = rand_enc,y=time_spent)) +\n  geom_point(alpha=0.8) +\n  stat_smooth(method=\"lm\",se=F)\n  labs(title = \"Distribution of Encouragement Variable\",\n       x = \"Encouragement\",\n       y = \"outcome\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> $x\n#> [1] \"Encouragement\"\n#> \n#> $y\n#> [1] \"outcome\"\n#> \n#> $title\n#> [1] \"Distribution of Encouragement Variable\"\n#> \n#> attr(,\"class\")\n#> [1] \"labels\"\n```\n:::\n\n```{.r .cell-code}\ncom_treat<-ggplot(rand_enc_data, aes(x = used_ftr,y=time_spent)) +\n  geom_point(alpha=0.8) +\n  stat_smooth(method=\"lm\",se=F)\n  labs(title = \"Distribution of Encouragement Variable\",\n       x = \"Treat\",\n       y = \"Outcome\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> $x\n#> [1] \"Treat\"\n#> \n#> $y\n#> [1] \"Outcome\"\n#> \n#> $title\n#> [1] \"Distribution of Encouragement Variable\"\n#> \n#> attr(,\"class\")\n#> [1] \"labels\"\n```\n:::\n\n```{.r .cell-code}\ncom_ins\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncom_outcome\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n```{.r .cell-code}\ncom_treat\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-3-3.png){width=672}\n:::\n\n```{.r .cell-code}\n# Check correlations: Examine correlations between variables of interest\ncor(rand_enc_data$rand_enc, rand_enc_data$time_spent)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.1296716\n```\n:::\n\n```{.r .cell-code}\ncor(rand_enc_data$rand_enc, rand_enc_data$used_ftr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.204411\n```\n:::\n\n```{.r .cell-code}\ncor(rand_enc_data$used_ftr,rand_enc_data$time_spent)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.7050147\n```\n:::\n:::\n\n4.)\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_17b7c4db4b305281b3e5d4f7afd219b1'}\n\n```{.r .cell-code}\n#1st method\n\nfirst_stage <-lm(used_ftr~rand_enc,data=rand_enc_data)\nsummary(first_stage)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = used_ftr ~ rand_enc, data = rand_enc_data)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -0.5071 -0.3062 -0.3062  0.4929  0.6938 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 0.306164   0.006851   44.69   <2e-16 ***\n#> rand_enc    0.200940   0.009624   20.88   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.4811 on 9998 degrees of freedom\n#> Multiple R-squared:  0.04178,\tAdjusted R-squared:  0.04169 \n#> F-statistic:   436 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nsecond_stage <-lm(rand_enc_data$time_spent~first_stage$fitted.values)\nsummary(second_stage)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = rand_enc_data$time_spent ~ first_stage$fitted.values)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -25.8757  -5.4714  -0.3263   5.3807  25.6541 \n#> \n#> Coefficients:\n#>                           Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)                19.3124     0.3129   61.72   <2e-16 ***\n#> first_stage$fitted.values   9.7382     0.7447   13.08   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 7.482 on 9998 degrees of freedom\n#> Multiple R-squared:  0.01681,\tAdjusted R-squared:  0.01672 \n#> F-statistic:   171 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\n#2nd method\nlibrary(estimatr)\nmodel <-iv_robust(time_spent~used_ftr|rand_enc,data=rand_enc_data)\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> iv_robust(formula = time_spent ~ used_ftr | rand_enc, data = rand_enc_data)\n#> \n#> Standard error type:  HC2 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value  Pr(>|t|) CI Lower CI Upper   DF\n#> (Intercept)   19.312     0.2248   85.89 0.000e+00   18.872    19.75 9998\n#> used_ftr       9.738     0.5353   18.19 8.716e-73    8.689    10.79 9998\n#> \n#> Multiple R-squared:  0.4921 ,\tAdjusted R-squared:  0.492 \n#> F-statistic:   331 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\nThere is significant difference between IV estimate and naive bias estimate and thus naive estimate is biased and that used_ftr coefficient is higher than expected and thus it is an upward bias.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}